{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime-corejs3/helpers/interopRequireDefault\");\n\nvar _find = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/find\"));\n\nvar _from = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/array/from\"));\n\nvar _map = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/map\"));\n\nvar _isArray = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/array/is-array\"));\n\nvar _keys2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/keys\"));\n\nvar _startsWith = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/starts-with\"));\n\nvar _keys3 = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/object/keys\"));\n\nvar _includes = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/includes\"));\n\nvar _filter = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/filter\"));\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime-corejs3/regenerator\"));\n\nvar _getIterator2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js/get-iterator\"));\n\nvar _concat = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/concat\"));\n\nvar _set = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/set\"));\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/toConsumableArray\"));\n\nvar _promise = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/promise\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/slicedToArray\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/asyncToGenerator\"));\n\nvar _CoreManager = _interopRequireDefault(require(\"./CoreManager\"));\n\nvar _ParseQuery = _interopRequireDefault(require(\"./ParseQuery\"));\n\nvar _LocalDatastoreUtils = require(\"./LocalDatastoreUtils\");\n/**\n * Copyright (c) 2015-present, Parse, LLC.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n *\n * @flow\n */\n\n/**\n * Provides a local datastore which can be used to store and retrieve <code>Parse.Object</code>. <br />\n * To enable this functionality, call <code>Parse.enableLocalDatastore()</code>.\n *\n * Pin object to add to local datastore\n *\n * <pre>await object.pin();</pre>\n * <pre>await object.pinWithName('pinName');</pre>\n *\n * Query pinned objects\n *\n * <pre>query.fromLocalDatastore();</pre>\n * <pre>query.fromPin();</pre>\n * <pre>query.fromPinWithName();</pre>\n *\n * <pre>const localObjects = await query.find();</pre>\n *\n * @class Parse.LocalDatastore\n * @static\n */\n\n\nvar LocalDatastore = {\n  isEnabled: false,\n  isSyncing: false,\n  fromPinWithName: function (name\n  /*: string*/\n  )\n  /*: Promise<Array<Object>>*/\n  {\n    var controller = _CoreManager.default.getLocalDatastoreController();\n\n    return controller.fromPinWithName(name);\n  },\n  pinWithName: function (name\n  /*: string*/\n  , value\n  /*: any*/\n  )\n  /*: Promise<void>*/\n  {\n    var controller = _CoreManager.default.getLocalDatastoreController();\n\n    return controller.pinWithName(name, value);\n  },\n  unPinWithName: function (name\n  /*: string*/\n  )\n  /*: Promise<void>*/\n  {\n    var controller = _CoreManager.default.getLocalDatastoreController();\n\n    return controller.unPinWithName(name);\n  },\n  _getAllContents: function ()\n  /*: Promise<Object>*/\n  {\n    var controller = _CoreManager.default.getLocalDatastoreController();\n\n    return controller.getAllContents();\n  },\n  // Use for testing\n  _getRawStorage: function ()\n  /*: Promise<Object>*/\n  {\n    var controller = _CoreManager.default.getLocalDatastoreController();\n\n    return controller.getRawStorage();\n  },\n  _clear: function ()\n  /*: Promise<void>*/\n  {\n    var controller = _CoreManager.default.getLocalDatastoreController();\n\n    return controller.clear();\n  },\n  // Pin the object and children recursively\n  // Saves the object and children key to Pin Name\n  _handlePinAllWithName: function () {\n    var _handlePinAllWithName2 = (0, _asyncToGenerator2.default)(\n    /*#__PURE__*/\n    _regenerator.default.mark(function _callee(name\n    /*: string*/\n    , objects\n    /*: Array<ParseObject>*/\n    ) {\n      var _context;\n\n      var pinName, toPinPromises, objectKeys, _iteratorNormalCompletion, _didIteratorError, _iteratorError, _iterator, _step, parent, children, parentKey, json, objectKey, fromPinPromise, _ref, _ref2, pinned, toPin;\n\n      return _regenerator.default.wrap(function (_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              pinName = this.getPinName(name);\n              toPinPromises = [];\n              objectKeys = [];\n              _iteratorNormalCompletion = true;\n              _didIteratorError = false;\n              _iteratorError = undefined;\n              _context2.prev = 6;\n\n              for (_iterator = (0, _getIterator2.default)(objects); !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n                parent = _step.value;\n                children = this._getChildren(parent);\n                parentKey = this.getKeyForObject(parent);\n                json = parent._toFullJSON();\n\n                if (parent._localId) {\n                  json._localId = parent._localId;\n                }\n\n                children[parentKey] = json;\n\n                for (objectKey in children) {\n                  objectKeys.push(objectKey);\n                  toPinPromises.push(this.pinWithName(objectKey, [children[objectKey]]));\n                }\n              }\n\n              _context2.next = 14;\n              break;\n\n            case 10:\n              _context2.prev = 10;\n              _context2.t0 = _context2[\"catch\"](6);\n              _didIteratorError = true;\n              _iteratorError = _context2.t0;\n\n            case 14:\n              _context2.prev = 14;\n              _context2.prev = 15;\n\n              if (!_iteratorNormalCompletion && _iterator.return != null) {\n                _iterator.return();\n              }\n\n            case 17:\n              _context2.prev = 17;\n\n              if (!_didIteratorError) {\n                _context2.next = 20;\n                break;\n              }\n\n              throw _iteratorError;\n\n            case 20:\n              return _context2.finish(17);\n\n            case 21:\n              return _context2.finish(14);\n\n            case 22:\n              fromPinPromise = this.fromPinWithName(pinName);\n              _context2.next = 25;\n              return _promise.default.all([fromPinPromise, toPinPromises]);\n\n            case 25:\n              _ref = _context2.sent;\n              _ref2 = (0, _slicedToArray2.default)(_ref, 1);\n              pinned = _ref2[0];\n              toPin = (0, _toConsumableArray2.default)(new _set.default((0, _concat.default)(_context = []).call(_context, (0, _toConsumableArray2.default)(pinned || []), objectKeys)));\n              return _context2.abrupt(\"return\", this.pinWithName(pinName, toPin));\n\n            case 30:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee, this, [[6, 10, 14, 22], [15,, 17, 21]]);\n    }));\n\n    return function () {\n      return _handlePinAllWithName2.apply(this, arguments);\n    };\n  }(),\n  // Removes object and children keys from pin name\n  // Keeps the object and children pinned\n  _handleUnPinAllWithName: function () {\n    var _handleUnPinAllWithName2 = (0, _asyncToGenerator2.default)(\n    /*#__PURE__*/\n    _regenerator.default.mark(function _callee2(name\n    /*: string*/\n    , objects\n    /*: Array<ParseObject>*/\n    ) {\n      var localDatastore, pinName, promises, objectKeys, _iteratorNormalCompletion2, _didIteratorError2, _iteratorError2, _iterator2, _step2, _objectKeys, _context3, parent, children, parentKey, pinned, _iteratorNormalCompletion3, _didIteratorError3, _iteratorError3, _iterator3, _step3, objectKey, hasReference, key, pinnedObjects;\n\n      return _regenerator.default.wrap(function (_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.next = 2;\n              return this._getAllContents();\n\n            case 2:\n              localDatastore = _context4.sent;\n              pinName = this.getPinName(name);\n              promises = [];\n              objectKeys = [];\n              _iteratorNormalCompletion2 = true;\n              _didIteratorError2 = false;\n              _iteratorError2 = undefined;\n              _context4.prev = 9;\n\n              for (_iterator2 = (0, _getIterator2.default)(objects); !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n                parent = _step2.value;\n                children = this._getChildren(parent);\n                parentKey = this.getKeyForObject(parent);\n\n                (_objectKeys = objectKeys).push.apply(_objectKeys, (0, _concat.default)(_context3 = [parentKey]).call(_context3, (0, _toConsumableArray2.default)((0, _keys3.default)(children))));\n              }\n\n              _context4.next = 17;\n              break;\n\n            case 13:\n              _context4.prev = 13;\n              _context4.t0 = _context4[\"catch\"](9);\n              _didIteratorError2 = true;\n              _iteratorError2 = _context4.t0;\n\n            case 17:\n              _context4.prev = 17;\n              _context4.prev = 18;\n\n              if (!_iteratorNormalCompletion2 && _iterator2.return != null) {\n                _iterator2.return();\n              }\n\n            case 20:\n              _context4.prev = 20;\n\n              if (!_didIteratorError2) {\n                _context4.next = 23;\n                break;\n              }\n\n              throw _iteratorError2;\n\n            case 23:\n              return _context4.finish(20);\n\n            case 24:\n              return _context4.finish(17);\n\n            case 25:\n              objectKeys = (0, _toConsumableArray2.default)(new _set.default(objectKeys));\n              pinned = localDatastore[pinName] || [];\n              pinned = (0, _filter.default)(pinned).call(pinned, function (item) {\n                return !(0, _includes.default)(objectKeys).call(objectKeys, item);\n              });\n\n              if (pinned.length == 0) {\n                promises.push(this.unPinWithName(pinName));\n                delete localDatastore[pinName];\n              } else {\n                promises.push(this.pinWithName(pinName, pinned));\n                localDatastore[pinName] = pinned;\n              }\n\n              _iteratorNormalCompletion3 = true;\n              _didIteratorError3 = false;\n              _iteratorError3 = undefined;\n              _context4.prev = 32;\n              _iterator3 = (0, _getIterator2.default)(objectKeys);\n\n            case 34:\n              if (_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done) {\n                _context4.next = 51;\n                break;\n              }\n\n              objectKey = _step3.value;\n              hasReference = false;\n              _context4.t1 = (0, _keys2.default)(_regenerator.default).call(_regenerator.default, localDatastore);\n\n            case 38:\n              if ((_context4.t2 = _context4.t1()).done) {\n                _context4.next = 47;\n                break;\n              }\n\n              key = _context4.t2.value;\n\n              if (!(key === _LocalDatastoreUtils.DEFAULT_PIN || (0, _startsWith.default)(key).call(key, _LocalDatastoreUtils.PIN_PREFIX))) {\n                _context4.next = 45;\n                break;\n              }\n\n              pinnedObjects = localDatastore[key] || [];\n\n              if (!(0, _includes.default)(pinnedObjects).call(pinnedObjects, objectKey)) {\n                _context4.next = 45;\n                break;\n              }\n\n              hasReference = true;\n              return _context4.abrupt(\"break\", 47);\n\n            case 45:\n              _context4.next = 38;\n              break;\n\n            case 47:\n              if (!hasReference) {\n                promises.push(this.unPinWithName(objectKey));\n              }\n\n            case 48:\n              _iteratorNormalCompletion3 = true;\n              _context4.next = 34;\n              break;\n\n            case 51:\n              _context4.next = 57;\n              break;\n\n            case 53:\n              _context4.prev = 53;\n              _context4.t3 = _context4[\"catch\"](32);\n              _didIteratorError3 = true;\n              _iteratorError3 = _context4.t3;\n\n            case 57:\n              _context4.prev = 57;\n              _context4.prev = 58;\n\n              if (!_iteratorNormalCompletion3 && _iterator3.return != null) {\n                _iterator3.return();\n              }\n\n            case 60:\n              _context4.prev = 60;\n\n              if (!_didIteratorError3) {\n                _context4.next = 63;\n                break;\n              }\n\n              throw _iteratorError3;\n\n            case 63:\n              return _context4.finish(60);\n\n            case 64:\n              return _context4.finish(57);\n\n            case 65:\n              return _context4.abrupt(\"return\", _promise.default.all(promises));\n\n            case 66:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee2, this, [[9, 13, 17, 25], [18,, 20, 24], [32, 53, 57, 65], [58,, 60, 64]]);\n    }));\n\n    return function () {\n      return _handleUnPinAllWithName2.apply(this, arguments);\n    };\n  }(),\n  // Retrieve all pointer fields from object recursively\n  _getChildren: function (object\n  /*: ParseObject*/\n  ) {\n    var encountered = {};\n\n    var json = object._toFullJSON();\n\n    for (var key in json) {\n      if (json[key] && json[key].__type && json[key].__type === 'Object') {\n        this._traverse(json[key], encountered);\n      }\n    }\n\n    return encountered;\n  },\n  _traverse: function (object\n  /*: any*/\n  , encountered\n  /*: any*/\n  ) {\n    if (!object.objectId) {\n      return;\n    } else {\n      var objectKey = this.getKeyForObject(object);\n\n      if (encountered[objectKey]) {\n        return;\n      }\n\n      encountered[objectKey] = object;\n    }\n\n    for (var key in object) {\n      var json = object[key];\n\n      if (!object[key]) {\n        json = object;\n      }\n\n      if (json.__type && json.__type === 'Object') {\n        this._traverse(json, encountered);\n      }\n    }\n  },\n  // Transform keys in pin name to objects\n  _serializeObjectsFromPinName: function () {\n    var _serializeObjectsFromPinName2 = (0, _asyncToGenerator2.default)(\n    /*#__PURE__*/\n    _regenerator.default.mark(function _callee3(name\n    /*: string*/\n    ) {\n      var _this = this,\n          _context5,\n          _concatInstanceProper,\n          _context6;\n\n      var localDatastore, allObjects, key, pinName, pinned, promises, objects;\n      return _regenerator.default.wrap(function (_context7) {\n        while (1) {\n          switch (_context7.prev = _context7.next) {\n            case 0:\n              _context7.next = 2;\n              return this._getAllContents();\n\n            case 2:\n              localDatastore = _context7.sent;\n              allObjects = [];\n\n              for (key in localDatastore) {\n                if ((0, _startsWith.default)(key).call(key, _LocalDatastoreUtils.OBJECT_PREFIX)) {\n                  allObjects.push(localDatastore[key][0]);\n                }\n              }\n\n              if (name) {\n                _context7.next = 7;\n                break;\n              }\n\n              return _context7.abrupt(\"return\", allObjects);\n\n            case 7:\n              pinName = this.getPinName(name);\n              pinned = localDatastore[pinName];\n\n              if ((0, _isArray.default)(pinned)) {\n                _context7.next = 11;\n                break;\n              }\n\n              return _context7.abrupt(\"return\", []);\n\n            case 11:\n              promises = (0, _map.default)(pinned).call(pinned, function (objectKey) {\n                return _this.fromPinWithName(objectKey);\n              });\n              _context7.next = 14;\n              return _promise.default.all(promises);\n\n            case 14:\n              objects = _context7.sent;\n              objects = (_concatInstanceProper = (0, _concat.default)(_context5 = [])).call.apply(_concatInstanceProper, (0, _concat.default)(_context6 = [_context5]).call(_context6, (0, _toConsumableArray2.default)(objects)));\n              return _context7.abrupt(\"return\", (0, _filter.default)(objects).call(objects, function (object) {\n                return object != null;\n              }));\n\n            case 17:\n            case \"end\":\n              return _context7.stop();\n          }\n        }\n      }, _callee3, this);\n    }));\n\n    return function () {\n      return _serializeObjectsFromPinName2.apply(this, arguments);\n    };\n  }(),\n  // Replaces object pointers with pinned pointers\n  // The object pointers may contain old data\n  // Uses Breadth First Search Algorithm\n  _serializeObject: function () {\n    var _serializeObject2 = (0, _asyncToGenerator2.default)(\n    /*#__PURE__*/\n    _regenerator.default.mark(function _callee4(objectKey\n    /*: string*/\n    , localDatastore\n    /*: any*/\n    ) {\n      var LDS, root, queue, meta, uniqueId, nodeId, subTreeRoot, field, value, key, pointer;\n      return _regenerator.default.wrap(function (_context8) {\n        while (1) {\n          switch (_context8.prev = _context8.next) {\n            case 0:\n              LDS = localDatastore;\n\n              if (LDS) {\n                _context8.next = 5;\n                break;\n              }\n\n              _context8.next = 4;\n              return this._getAllContents();\n\n            case 4:\n              LDS = _context8.sent;\n\n            case 5:\n              if (!(!LDS[objectKey] || LDS[objectKey].length === 0)) {\n                _context8.next = 7;\n                break;\n              }\n\n              return _context8.abrupt(\"return\", null);\n\n            case 7:\n              root = LDS[objectKey][0];\n              queue = [];\n              meta = {};\n              uniqueId = 0;\n              meta[uniqueId] = root;\n              queue.push(uniqueId);\n\n              while (queue.length !== 0) {\n                nodeId = queue.shift();\n                subTreeRoot = meta[nodeId];\n\n                for (field in subTreeRoot) {\n                  value = subTreeRoot[field];\n\n                  if (value.__type && value.__type === 'Object') {\n                    key = this.getKeyForObject(value);\n\n                    if (LDS[key] && LDS[key].length > 0) {\n                      pointer = LDS[key][0];\n                      uniqueId++;\n                      meta[uniqueId] = pointer;\n                      subTreeRoot[field] = pointer;\n                      queue.push(uniqueId);\n                    }\n                  }\n                }\n              }\n\n              return _context8.abrupt(\"return\", root);\n\n            case 15:\n            case \"end\":\n              return _context8.stop();\n          }\n        }\n      }, _callee4, this);\n    }));\n\n    return function () {\n      return _serializeObject2.apply(this, arguments);\n    };\n  }(),\n  // Called when an object is save / fetched\n  // Update object pin value\n  _updateObjectIfPinned: function () {\n    var _updateObjectIfPinned2 = (0, _asyncToGenerator2.default)(\n    /*#__PURE__*/\n    _regenerator.default.mark(function _callee5(object\n    /*: ParseObject*/\n    ) {\n      var objectKey, pinned;\n      return _regenerator.default.wrap(function (_context9) {\n        while (1) {\n          switch (_context9.prev = _context9.next) {\n            case 0:\n              if (this.isEnabled) {\n                _context9.next = 2;\n                break;\n              }\n\n              return _context9.abrupt(\"return\");\n\n            case 2:\n              objectKey = this.getKeyForObject(object);\n              _context9.next = 5;\n              return this.fromPinWithName(objectKey);\n\n            case 5:\n              pinned = _context9.sent;\n\n              if (!(!pinned || pinned.length === 0)) {\n                _context9.next = 8;\n                break;\n              }\n\n              return _context9.abrupt(\"return\");\n\n            case 8:\n              return _context9.abrupt(\"return\", this.pinWithName(objectKey, [object._toFullJSON()]));\n\n            case 9:\n            case \"end\":\n              return _context9.stop();\n          }\n        }\n      }, _callee5, this);\n    }));\n\n    return function () {\n      return _updateObjectIfPinned2.apply(this, arguments);\n    };\n  }(),\n  // Called when object is destroyed\n  // Unpin object and remove all references from pin names\n  // TODO: Destroy children?\n  _destroyObjectIfPinned: function () {\n    var _destroyObjectIfPinned2 = (0, _asyncToGenerator2.default)(\n    /*#__PURE__*/\n    _regenerator.default.mark(function _callee6(object\n    /*: ParseObject*/\n    ) {\n      var localDatastore, objectKey, pin, promises, key, pinned;\n      return _regenerator.default.wrap(function (_context10) {\n        while (1) {\n          switch (_context10.prev = _context10.next) {\n            case 0:\n              if (this.isEnabled) {\n                _context10.next = 2;\n                break;\n              }\n\n              return _context10.abrupt(\"return\");\n\n            case 2:\n              _context10.next = 4;\n              return this._getAllContents();\n\n            case 4:\n              localDatastore = _context10.sent;\n              objectKey = this.getKeyForObject(object);\n              pin = localDatastore[objectKey];\n\n              if (pin) {\n                _context10.next = 9;\n                break;\n              }\n\n              return _context10.abrupt(\"return\");\n\n            case 9:\n              promises = [this.unPinWithName(objectKey)];\n              delete localDatastore[objectKey];\n\n              for (key in localDatastore) {\n                if (key === _LocalDatastoreUtils.DEFAULT_PIN || (0, _startsWith.default)(key).call(key, _LocalDatastoreUtils.PIN_PREFIX)) {\n                  pinned = localDatastore[key] || [];\n\n                  if ((0, _includes.default)(pinned).call(pinned, objectKey)) {\n                    pinned = (0, _filter.default)(pinned).call(pinned, function (item) {\n                      return item !== objectKey;\n                    });\n\n                    if (pinned.length == 0) {\n                      promises.push(this.unPinWithName(key));\n                      delete localDatastore[key];\n                    } else {\n                      promises.push(this.pinWithName(key, pinned));\n                      localDatastore[key] = pinned;\n                    }\n                  }\n                }\n              }\n\n              return _context10.abrupt(\"return\", _promise.default.all(promises));\n\n            case 13:\n            case \"end\":\n              return _context10.stop();\n          }\n        }\n      }, _callee6, this);\n    }));\n\n    return function () {\n      return _destroyObjectIfPinned2.apply(this, arguments);\n    };\n  }(),\n  // Update pin and references of the unsaved object\n  _updateLocalIdForObject: function () {\n    var _updateLocalIdForObject2 = (0, _asyncToGenerator2.default)(\n    /*#__PURE__*/\n    _regenerator.default.mark(function _callee7(localId\n    /*: string*/\n    , object\n    /*: ParseObject*/\n    ) {\n      var _context11, _context12;\n\n      var localKey, objectKey, unsaved, promises, localDatastore, key, pinned;\n      return _regenerator.default.wrap(function (_context13) {\n        while (1) {\n          switch (_context13.prev = _context13.next) {\n            case 0:\n              if (this.isEnabled) {\n                _context13.next = 2;\n                break;\n              }\n\n              return _context13.abrupt(\"return\");\n\n            case 2:\n              localKey = (0, _concat.default)(_context11 = (0, _concat.default)(_context12 = \"\".concat(_LocalDatastoreUtils.OBJECT_PREFIX)).call(_context12, object.className, \"_\")).call(_context11, localId);\n              objectKey = this.getKeyForObject(object);\n              _context13.next = 6;\n              return this.fromPinWithName(localKey);\n\n            case 6:\n              unsaved = _context13.sent;\n\n              if (!(!unsaved || unsaved.length === 0)) {\n                _context13.next = 9;\n                break;\n              }\n\n              return _context13.abrupt(\"return\");\n\n            case 9:\n              promises = [this.unPinWithName(localKey), this.pinWithName(objectKey, unsaved)];\n              _context13.next = 12;\n              return this._getAllContents();\n\n            case 12:\n              localDatastore = _context13.sent;\n\n              for (key in localDatastore) {\n                if (key === _LocalDatastoreUtils.DEFAULT_PIN || (0, _startsWith.default)(key).call(key, _LocalDatastoreUtils.PIN_PREFIX)) {\n                  pinned = localDatastore[key] || [];\n\n                  if ((0, _includes.default)(pinned).call(pinned, localKey)) {\n                    pinned = (0, _filter.default)(pinned).call(pinned, function (item) {\n                      return item !== localKey;\n                    });\n                    pinned.push(objectKey);\n                    promises.push(this.pinWithName(key, pinned));\n                    localDatastore[key] = pinned;\n                  }\n                }\n              }\n\n              return _context13.abrupt(\"return\", _promise.default.all(promises));\n\n            case 15:\n            case \"end\":\n              return _context13.stop();\n          }\n        }\n      }, _callee7, this);\n    }));\n\n    return function () {\n      return _updateLocalIdForObject2.apply(this, arguments);\n    };\n  }(),\n\n  /**\n   * Updates Local Datastore from Server\n   *\n   * <pre>\n   * await Parse.LocalDatastore.updateFromServer();\n   * </pre>\n   * @method updateFromServer\n   * @name Parse.LocalDatastore.updateFromServer\n   * @static\n   */\n  updateFromServer: function () {\n    var _updateFromServer = (0, _asyncToGenerator2.default)(\n    /*#__PURE__*/\n    _regenerator.default.mark(function _callee8() {\n      var _context14,\n          _this2 = this;\n\n      var localDatastore, keys, key, pointersHash, _i, _keys, _key, _key$split, _key$split2, className, objectId, queryPromises, responses, objects, pinPromises;\n\n      return _regenerator.default.wrap(function (_context15) {\n        while (1) {\n          switch (_context15.prev = _context15.next) {\n            case 0:\n              if (!(!this.checkIfEnabled() || this.isSyncing)) {\n                _context15.next = 2;\n                break;\n              }\n\n              return _context15.abrupt(\"return\");\n\n            case 2:\n              _context15.next = 4;\n              return this._getAllContents();\n\n            case 4:\n              localDatastore = _context15.sent;\n              keys = [];\n\n              for (key in localDatastore) {\n                if ((0, _startsWith.default)(key).call(key, _LocalDatastoreUtils.OBJECT_PREFIX)) {\n                  keys.push(key);\n                }\n              }\n\n              if (!(keys.length === 0)) {\n                _context15.next = 9;\n                break;\n              }\n\n              return _context15.abrupt(\"return\");\n\n            case 9:\n              this.isSyncing = true;\n              pointersHash = {};\n              _i = 0, _keys = keys;\n\n            case 12:\n              if (!(_i < _keys.length)) {\n                _context15.next = 23;\n                break;\n              }\n\n              _key = _keys[_i]; // Ignore the OBJECT_PREFIX\n\n              _key$split = _key.split('_'), _key$split2 = (0, _slicedToArray2.default)(_key$split, 4), className = _key$split2[2], objectId = _key$split2[3]; // User key is split into [ 'Parse', 'LDS', '', 'User', 'objectId' ]\n\n              if (_key.split('_').length === 5 && _key.split('_')[3] === 'User') {\n                className = '_User';\n                objectId = _key.split('_')[4];\n              }\n\n              if (!(0, _startsWith.default)(objectId).call(objectId, 'local')) {\n                _context15.next = 18;\n                break;\n              }\n\n              return _context15.abrupt(\"continue\", 20);\n\n            case 18:\n              if (!(className in pointersHash)) {\n                pointersHash[className] = new _set.default();\n              }\n\n              pointersHash[className].add(objectId);\n\n            case 20:\n              _i++;\n              _context15.next = 12;\n              break;\n\n            case 23:\n              queryPromises = (0, _map.default)(_context14 = (0, _keys3.default)(pointersHash)).call(_context14, function (className) {\n                var objectIds = (0, _from.default)(pointersHash[className]);\n                var query = new _ParseQuery.default(className);\n                query.limit(objectIds.length);\n\n                if (objectIds.length === 1) {\n                  query.equalTo('objectId', objectIds[0]);\n                } else {\n                  query.containedIn('objectId', objectIds);\n                }\n\n                return (0, _find.default)(query).call(query);\n              });\n              _context15.prev = 24;\n              _context15.next = 27;\n              return _promise.default.all(queryPromises);\n\n            case 27:\n              responses = _context15.sent;\n              objects = (0, _concat.default)([]).apply([], responses);\n              pinPromises = (0, _map.default)(objects).call(objects, function (object) {\n                var objectKey = _this2.getKeyForObject(object);\n\n                return _this2.pinWithName(objectKey, object._toFullJSON());\n              });\n              _context15.next = 32;\n              return _promise.default.all(pinPromises);\n\n            case 32:\n              this.isSyncing = false;\n              _context15.next = 39;\n              break;\n\n            case 35:\n              _context15.prev = 35;\n              _context15.t0 = _context15[\"catch\"](24);\n              console.error('Error syncing LocalDatastore: ', _context15.t0);\n              this.isSyncing = false;\n\n            case 39:\n            case \"end\":\n              return _context15.stop();\n          }\n        }\n      }, _callee8, this, [[24, 35]]);\n    }));\n\n    return function () {\n      return _updateFromServer.apply(this, arguments);\n    };\n  }(),\n  getKeyForObject: function (object\n  /*: any*/\n  ) {\n    var _context16, _context17;\n\n    var objectId = object.objectId || object._getId();\n\n    return (0, _concat.default)(_context16 = (0, _concat.default)(_context17 = \"\".concat(_LocalDatastoreUtils.OBJECT_PREFIX)).call(_context17, object.className, \"_\")).call(_context16, objectId);\n  },\n  getPinName: function (pinName\n  /*: ?string*/\n  ) {\n    if (!pinName || pinName === _LocalDatastoreUtils.DEFAULT_PIN) {\n      return _LocalDatastoreUtils.DEFAULT_PIN;\n    }\n\n    return _LocalDatastoreUtils.PIN_PREFIX + pinName;\n  },\n  checkIfEnabled: function () {\n    if (!this.isEnabled) {\n      console.error('Parse.enableLocalDatastore() must be called first');\n    }\n\n    return this.isEnabled;\n  }\n};\nmodule.exports = LocalDatastore;\n\n_CoreManager.default.setLocalDatastoreController(require('./LocalDatastoreController'));\n\n_CoreManager.default.setLocalDatastore(LocalDatastore);","map":{"version":3,"sources":["/home/roxana/React-Project/crud/node_modules/parse/lib/browser/LocalDatastore.js"],"names":["_interopRequireDefault","require","_find","_from","_map","_isArray","_keys2","_startsWith","_keys3","_includes","_filter","_regenerator","_getIterator2","_concat","_set","_toConsumableArray2","_promise","_slicedToArray2","_asyncToGenerator2","_CoreManager","_ParseQuery","_LocalDatastoreUtils","LocalDatastore","isEnabled","isSyncing","fromPinWithName","name","controller","default","getLocalDatastoreController","pinWithName","value","unPinWithName","_getAllContents","getAllContents","_getRawStorage","getRawStorage","_clear","clear","_handlePinAllWithName","_handlePinAllWithName2","mark","_callee","objects","_context","pinName","toPinPromises","objectKeys","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_iterator","_step","parent","children","parentKey","json","objectKey","fromPinPromise","_ref","_ref2","pinned","toPin","wrap","_context2","prev","next","getPinName","undefined","done","_getChildren","getKeyForObject","_toFullJSON","_localId","push","t0","return","finish","all","sent","call","abrupt","stop","apply","arguments","_handleUnPinAllWithName","_handleUnPinAllWithName2","_callee2","localDatastore","promises","_iteratorNormalCompletion2","_didIteratorError2","_iteratorError2","_iterator2","_step2","_objectKeys","_context3","_iteratorNormalCompletion3","_didIteratorError3","_iteratorError3","_iterator3","_step3","hasReference","key","pinnedObjects","_context4","item","length","t1","t2","DEFAULT_PIN","PIN_PREFIX","t3","object","encountered","__type","_traverse","objectId","_serializeObjectsFromPinName","_serializeObjectsFromPinName2","_callee3","_this","_context5","_concatInstanceProper","_context6","allObjects","_context7","OBJECT_PREFIX","_serializeObject","_serializeObject2","_callee4","LDS","root","queue","meta","uniqueId","nodeId","subTreeRoot","field","pointer","_context8","shift","_updateObjectIfPinned","_updateObjectIfPinned2","_callee5","_context9","_destroyObjectIfPinned","_destroyObjectIfPinned2","_callee6","pin","_context10","_updateLocalIdForObject","_updateLocalIdForObject2","_callee7","localId","_context11","_context12","localKey","unsaved","_context13","concat","className","updateFromServer","_updateFromServer","_callee8","_context14","_this2","keys","pointersHash","_i","_keys","_key","_key$split","_key$split2","queryPromises","responses","pinPromises","_context15","checkIfEnabled","split","add","objectIds","query","limit","equalTo","containedIn","console","error","_context16","_context17","_getId","module","exports","setLocalDatastoreController","setLocalDatastore"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime-corejs3/helpers/interopRequireDefault\");\n\nvar _find = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/find\"));\n\nvar _from = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/array/from\"));\n\nvar _map = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/map\"));\n\nvar _isArray = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/array/is-array\"));\n\nvar _keys2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/keys\"));\n\nvar _startsWith = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/starts-with\"));\n\nvar _keys3 = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/object/keys\"));\n\nvar _includes = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/includes\"));\n\nvar _filter = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/filter\"));\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime-corejs3/regenerator\"));\n\nvar _getIterator2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js/get-iterator\"));\n\nvar _concat = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/instance/concat\"));\n\nvar _set = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/set\"));\n\nvar _toConsumableArray2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/toConsumableArray\"));\n\nvar _promise = _interopRequireDefault(require(\"@babel/runtime-corejs3/core-js-stable/promise\"));\n\nvar _slicedToArray2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/slicedToArray\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime-corejs3/helpers/asyncToGenerator\"));\n\nvar _CoreManager = _interopRequireDefault(require(\"./CoreManager\"));\n\nvar _ParseQuery = _interopRequireDefault(require(\"./ParseQuery\"));\n\nvar _LocalDatastoreUtils = require(\"./LocalDatastoreUtils\");\n/**\n * Copyright (c) 2015-present, Parse, LLC.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n *\n * @flow\n */\n\n/**\n * Provides a local datastore which can be used to store and retrieve <code>Parse.Object</code>. <br />\n * To enable this functionality, call <code>Parse.enableLocalDatastore()</code>.\n *\n * Pin object to add to local datastore\n *\n * <pre>await object.pin();</pre>\n * <pre>await object.pinWithName('pinName');</pre>\n *\n * Query pinned objects\n *\n * <pre>query.fromLocalDatastore();</pre>\n * <pre>query.fromPin();</pre>\n * <pre>query.fromPinWithName();</pre>\n *\n * <pre>const localObjects = await query.find();</pre>\n *\n * @class Parse.LocalDatastore\n * @static\n */\n\n\nvar LocalDatastore = {\n  isEnabled: false,\n  isSyncing: false,\n  fromPinWithName: function (name\n  /*: string*/\n  )\n  /*: Promise<Array<Object>>*/\n  {\n    var controller = _CoreManager.default.getLocalDatastoreController();\n\n    return controller.fromPinWithName(name);\n  },\n  pinWithName: function (name\n  /*: string*/\n  , value\n  /*: any*/\n  )\n  /*: Promise<void>*/\n  {\n    var controller = _CoreManager.default.getLocalDatastoreController();\n\n    return controller.pinWithName(name, value);\n  },\n  unPinWithName: function (name\n  /*: string*/\n  )\n  /*: Promise<void>*/\n  {\n    var controller = _CoreManager.default.getLocalDatastoreController();\n\n    return controller.unPinWithName(name);\n  },\n  _getAllContents: function ()\n  /*: Promise<Object>*/\n  {\n    var controller = _CoreManager.default.getLocalDatastoreController();\n\n    return controller.getAllContents();\n  },\n  // Use for testing\n  _getRawStorage: function ()\n  /*: Promise<Object>*/\n  {\n    var controller = _CoreManager.default.getLocalDatastoreController();\n\n    return controller.getRawStorage();\n  },\n  _clear: function ()\n  /*: Promise<void>*/\n  {\n    var controller = _CoreManager.default.getLocalDatastoreController();\n\n    return controller.clear();\n  },\n  // Pin the object and children recursively\n  // Saves the object and children key to Pin Name\n  _handlePinAllWithName: function () {\n    var _handlePinAllWithName2 = (0, _asyncToGenerator2.default)(\n    /*#__PURE__*/\n    _regenerator.default.mark(function _callee(name\n    /*: string*/\n    , objects\n    /*: Array<ParseObject>*/\n    ) {\n      var _context;\n\n      var pinName, toPinPromises, objectKeys, _iteratorNormalCompletion, _didIteratorError, _iteratorError, _iterator, _step, parent, children, parentKey, json, objectKey, fromPinPromise, _ref, _ref2, pinned, toPin;\n\n      return _regenerator.default.wrap(function (_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              pinName = this.getPinName(name);\n              toPinPromises = [];\n              objectKeys = [];\n              _iteratorNormalCompletion = true;\n              _didIteratorError = false;\n              _iteratorError = undefined;\n              _context2.prev = 6;\n\n              for (_iterator = (0, _getIterator2.default)(objects); !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n                parent = _step.value;\n                children = this._getChildren(parent);\n                parentKey = this.getKeyForObject(parent);\n                json = parent._toFullJSON();\n\n                if (parent._localId) {\n                  json._localId = parent._localId;\n                }\n\n                children[parentKey] = json;\n\n                for (objectKey in children) {\n                  objectKeys.push(objectKey);\n                  toPinPromises.push(this.pinWithName(objectKey, [children[objectKey]]));\n                }\n              }\n\n              _context2.next = 14;\n              break;\n\n            case 10:\n              _context2.prev = 10;\n              _context2.t0 = _context2[\"catch\"](6);\n              _didIteratorError = true;\n              _iteratorError = _context2.t0;\n\n            case 14:\n              _context2.prev = 14;\n              _context2.prev = 15;\n\n              if (!_iteratorNormalCompletion && _iterator.return != null) {\n                _iterator.return();\n              }\n\n            case 17:\n              _context2.prev = 17;\n\n              if (!_didIteratorError) {\n                _context2.next = 20;\n                break;\n              }\n\n              throw _iteratorError;\n\n            case 20:\n              return _context2.finish(17);\n\n            case 21:\n              return _context2.finish(14);\n\n            case 22:\n              fromPinPromise = this.fromPinWithName(pinName);\n              _context2.next = 25;\n              return _promise.default.all([fromPinPromise, toPinPromises]);\n\n            case 25:\n              _ref = _context2.sent;\n              _ref2 = (0, _slicedToArray2.default)(_ref, 1);\n              pinned = _ref2[0];\n              toPin = (0, _toConsumableArray2.default)(new _set.default((0, _concat.default)(_context = []).call(_context, (0, _toConsumableArray2.default)(pinned || []), objectKeys)));\n              return _context2.abrupt(\"return\", this.pinWithName(pinName, toPin));\n\n            case 30:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee, this, [[6, 10, 14, 22], [15,, 17, 21]]);\n    }));\n\n    return function () {\n      return _handlePinAllWithName2.apply(this, arguments);\n    };\n  }(),\n  // Removes object and children keys from pin name\n  // Keeps the object and children pinned\n  _handleUnPinAllWithName: function () {\n    var _handleUnPinAllWithName2 = (0, _asyncToGenerator2.default)(\n    /*#__PURE__*/\n    _regenerator.default.mark(function _callee2(name\n    /*: string*/\n    , objects\n    /*: Array<ParseObject>*/\n    ) {\n      var localDatastore, pinName, promises, objectKeys, _iteratorNormalCompletion2, _didIteratorError2, _iteratorError2, _iterator2, _step2, _objectKeys, _context3, parent, children, parentKey, pinned, _iteratorNormalCompletion3, _didIteratorError3, _iteratorError3, _iterator3, _step3, objectKey, hasReference, key, pinnedObjects;\n\n      return _regenerator.default.wrap(function (_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.next = 2;\n              return this._getAllContents();\n\n            case 2:\n              localDatastore = _context4.sent;\n              pinName = this.getPinName(name);\n              promises = [];\n              objectKeys = [];\n              _iteratorNormalCompletion2 = true;\n              _didIteratorError2 = false;\n              _iteratorError2 = undefined;\n              _context4.prev = 9;\n\n              for (_iterator2 = (0, _getIterator2.default)(objects); !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n                parent = _step2.value;\n                children = this._getChildren(parent);\n                parentKey = this.getKeyForObject(parent);\n\n                (_objectKeys = objectKeys).push.apply(_objectKeys, (0, _concat.default)(_context3 = [parentKey]).call(_context3, (0, _toConsumableArray2.default)((0, _keys3.default)(children))));\n              }\n\n              _context4.next = 17;\n              break;\n\n            case 13:\n              _context4.prev = 13;\n              _context4.t0 = _context4[\"catch\"](9);\n              _didIteratorError2 = true;\n              _iteratorError2 = _context4.t0;\n\n            case 17:\n              _context4.prev = 17;\n              _context4.prev = 18;\n\n              if (!_iteratorNormalCompletion2 && _iterator2.return != null) {\n                _iterator2.return();\n              }\n\n            case 20:\n              _context4.prev = 20;\n\n              if (!_didIteratorError2) {\n                _context4.next = 23;\n                break;\n              }\n\n              throw _iteratorError2;\n\n            case 23:\n              return _context4.finish(20);\n\n            case 24:\n              return _context4.finish(17);\n\n            case 25:\n              objectKeys = (0, _toConsumableArray2.default)(new _set.default(objectKeys));\n              pinned = localDatastore[pinName] || [];\n              pinned = (0, _filter.default)(pinned).call(pinned, function (item) {\n                return !(0, _includes.default)(objectKeys).call(objectKeys, item);\n              });\n\n              if (pinned.length == 0) {\n                promises.push(this.unPinWithName(pinName));\n                delete localDatastore[pinName];\n              } else {\n                promises.push(this.pinWithName(pinName, pinned));\n                localDatastore[pinName] = pinned;\n              }\n\n              _iteratorNormalCompletion3 = true;\n              _didIteratorError3 = false;\n              _iteratorError3 = undefined;\n              _context4.prev = 32;\n              _iterator3 = (0, _getIterator2.default)(objectKeys);\n\n            case 34:\n              if (_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done) {\n                _context4.next = 51;\n                break;\n              }\n\n              objectKey = _step3.value;\n              hasReference = false;\n              _context4.t1 = (0, _keys2.default)(_regenerator.default).call(_regenerator.default, localDatastore);\n\n            case 38:\n              if ((_context4.t2 = _context4.t1()).done) {\n                _context4.next = 47;\n                break;\n              }\n\n              key = _context4.t2.value;\n\n              if (!(key === _LocalDatastoreUtils.DEFAULT_PIN || (0, _startsWith.default)(key).call(key, _LocalDatastoreUtils.PIN_PREFIX))) {\n                _context4.next = 45;\n                break;\n              }\n\n              pinnedObjects = localDatastore[key] || [];\n\n              if (!(0, _includes.default)(pinnedObjects).call(pinnedObjects, objectKey)) {\n                _context4.next = 45;\n                break;\n              }\n\n              hasReference = true;\n              return _context4.abrupt(\"break\", 47);\n\n            case 45:\n              _context4.next = 38;\n              break;\n\n            case 47:\n              if (!hasReference) {\n                promises.push(this.unPinWithName(objectKey));\n              }\n\n            case 48:\n              _iteratorNormalCompletion3 = true;\n              _context4.next = 34;\n              break;\n\n            case 51:\n              _context4.next = 57;\n              break;\n\n            case 53:\n              _context4.prev = 53;\n              _context4.t3 = _context4[\"catch\"](32);\n              _didIteratorError3 = true;\n              _iteratorError3 = _context4.t3;\n\n            case 57:\n              _context4.prev = 57;\n              _context4.prev = 58;\n\n              if (!_iteratorNormalCompletion3 && _iterator3.return != null) {\n                _iterator3.return();\n              }\n\n            case 60:\n              _context4.prev = 60;\n\n              if (!_didIteratorError3) {\n                _context4.next = 63;\n                break;\n              }\n\n              throw _iteratorError3;\n\n            case 63:\n              return _context4.finish(60);\n\n            case 64:\n              return _context4.finish(57);\n\n            case 65:\n              return _context4.abrupt(\"return\", _promise.default.all(promises));\n\n            case 66:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee2, this, [[9, 13, 17, 25], [18,, 20, 24], [32, 53, 57, 65], [58,, 60, 64]]);\n    }));\n\n    return function () {\n      return _handleUnPinAllWithName2.apply(this, arguments);\n    };\n  }(),\n  // Retrieve all pointer fields from object recursively\n  _getChildren: function (object\n  /*: ParseObject*/\n  ) {\n    var encountered = {};\n\n    var json = object._toFullJSON();\n\n    for (var key in json) {\n      if (json[key] && json[key].__type && json[key].__type === 'Object') {\n        this._traverse(json[key], encountered);\n      }\n    }\n\n    return encountered;\n  },\n  _traverse: function (object\n  /*: any*/\n  , encountered\n  /*: any*/\n  ) {\n    if (!object.objectId) {\n      return;\n    } else {\n      var objectKey = this.getKeyForObject(object);\n\n      if (encountered[objectKey]) {\n        return;\n      }\n\n      encountered[objectKey] = object;\n    }\n\n    for (var key in object) {\n      var json = object[key];\n\n      if (!object[key]) {\n        json = object;\n      }\n\n      if (json.__type && json.__type === 'Object') {\n        this._traverse(json, encountered);\n      }\n    }\n  },\n  // Transform keys in pin name to objects\n  _serializeObjectsFromPinName: function () {\n    var _serializeObjectsFromPinName2 = (0, _asyncToGenerator2.default)(\n    /*#__PURE__*/\n    _regenerator.default.mark(function _callee3(name\n    /*: string*/\n    ) {\n      var _this = this,\n          _context5,\n          _concatInstanceProper,\n          _context6;\n\n      var localDatastore, allObjects, key, pinName, pinned, promises, objects;\n      return _regenerator.default.wrap(function (_context7) {\n        while (1) {\n          switch (_context7.prev = _context7.next) {\n            case 0:\n              _context7.next = 2;\n              return this._getAllContents();\n\n            case 2:\n              localDatastore = _context7.sent;\n              allObjects = [];\n\n              for (key in localDatastore) {\n                if ((0, _startsWith.default)(key).call(key, _LocalDatastoreUtils.OBJECT_PREFIX)) {\n                  allObjects.push(localDatastore[key][0]);\n                }\n              }\n\n              if (name) {\n                _context7.next = 7;\n                break;\n              }\n\n              return _context7.abrupt(\"return\", allObjects);\n\n            case 7:\n              pinName = this.getPinName(name);\n              pinned = localDatastore[pinName];\n\n              if ((0, _isArray.default)(pinned)) {\n                _context7.next = 11;\n                break;\n              }\n\n              return _context7.abrupt(\"return\", []);\n\n            case 11:\n              promises = (0, _map.default)(pinned).call(pinned, function (objectKey) {\n                return _this.fromPinWithName(objectKey);\n              });\n              _context7.next = 14;\n              return _promise.default.all(promises);\n\n            case 14:\n              objects = _context7.sent;\n              objects = (_concatInstanceProper = (0, _concat.default)(_context5 = [])).call.apply(_concatInstanceProper, (0, _concat.default)(_context6 = [_context5]).call(_context6, (0, _toConsumableArray2.default)(objects)));\n              return _context7.abrupt(\"return\", (0, _filter.default)(objects).call(objects, function (object) {\n                return object != null;\n              }));\n\n            case 17:\n            case \"end\":\n              return _context7.stop();\n          }\n        }\n      }, _callee3, this);\n    }));\n\n    return function () {\n      return _serializeObjectsFromPinName2.apply(this, arguments);\n    };\n  }(),\n  // Replaces object pointers with pinned pointers\n  // The object pointers may contain old data\n  // Uses Breadth First Search Algorithm\n  _serializeObject: function () {\n    var _serializeObject2 = (0, _asyncToGenerator2.default)(\n    /*#__PURE__*/\n    _regenerator.default.mark(function _callee4(objectKey\n    /*: string*/\n    , localDatastore\n    /*: any*/\n    ) {\n      var LDS, root, queue, meta, uniqueId, nodeId, subTreeRoot, field, value, key, pointer;\n      return _regenerator.default.wrap(function (_context8) {\n        while (1) {\n          switch (_context8.prev = _context8.next) {\n            case 0:\n              LDS = localDatastore;\n\n              if (LDS) {\n                _context8.next = 5;\n                break;\n              }\n\n              _context8.next = 4;\n              return this._getAllContents();\n\n            case 4:\n              LDS = _context8.sent;\n\n            case 5:\n              if (!(!LDS[objectKey] || LDS[objectKey].length === 0)) {\n                _context8.next = 7;\n                break;\n              }\n\n              return _context8.abrupt(\"return\", null);\n\n            case 7:\n              root = LDS[objectKey][0];\n              queue = [];\n              meta = {};\n              uniqueId = 0;\n              meta[uniqueId] = root;\n              queue.push(uniqueId);\n\n              while (queue.length !== 0) {\n                nodeId = queue.shift();\n                subTreeRoot = meta[nodeId];\n\n                for (field in subTreeRoot) {\n                  value = subTreeRoot[field];\n\n                  if (value.__type && value.__type === 'Object') {\n                    key = this.getKeyForObject(value);\n\n                    if (LDS[key] && LDS[key].length > 0) {\n                      pointer = LDS[key][0];\n                      uniqueId++;\n                      meta[uniqueId] = pointer;\n                      subTreeRoot[field] = pointer;\n                      queue.push(uniqueId);\n                    }\n                  }\n                }\n              }\n\n              return _context8.abrupt(\"return\", root);\n\n            case 15:\n            case \"end\":\n              return _context8.stop();\n          }\n        }\n      }, _callee4, this);\n    }));\n\n    return function () {\n      return _serializeObject2.apply(this, arguments);\n    };\n  }(),\n  // Called when an object is save / fetched\n  // Update object pin value\n  _updateObjectIfPinned: function () {\n    var _updateObjectIfPinned2 = (0, _asyncToGenerator2.default)(\n    /*#__PURE__*/\n    _regenerator.default.mark(function _callee5(object\n    /*: ParseObject*/\n    ) {\n      var objectKey, pinned;\n      return _regenerator.default.wrap(function (_context9) {\n        while (1) {\n          switch (_context9.prev = _context9.next) {\n            case 0:\n              if (this.isEnabled) {\n                _context9.next = 2;\n                break;\n              }\n\n              return _context9.abrupt(\"return\");\n\n            case 2:\n              objectKey = this.getKeyForObject(object);\n              _context9.next = 5;\n              return this.fromPinWithName(objectKey);\n\n            case 5:\n              pinned = _context9.sent;\n\n              if (!(!pinned || pinned.length === 0)) {\n                _context9.next = 8;\n                break;\n              }\n\n              return _context9.abrupt(\"return\");\n\n            case 8:\n              return _context9.abrupt(\"return\", this.pinWithName(objectKey, [object._toFullJSON()]));\n\n            case 9:\n            case \"end\":\n              return _context9.stop();\n          }\n        }\n      }, _callee5, this);\n    }));\n\n    return function () {\n      return _updateObjectIfPinned2.apply(this, arguments);\n    };\n  }(),\n  // Called when object is destroyed\n  // Unpin object and remove all references from pin names\n  // TODO: Destroy children?\n  _destroyObjectIfPinned: function () {\n    var _destroyObjectIfPinned2 = (0, _asyncToGenerator2.default)(\n    /*#__PURE__*/\n    _regenerator.default.mark(function _callee6(object\n    /*: ParseObject*/\n    ) {\n      var localDatastore, objectKey, pin, promises, key, pinned;\n      return _regenerator.default.wrap(function (_context10) {\n        while (1) {\n          switch (_context10.prev = _context10.next) {\n            case 0:\n              if (this.isEnabled) {\n                _context10.next = 2;\n                break;\n              }\n\n              return _context10.abrupt(\"return\");\n\n            case 2:\n              _context10.next = 4;\n              return this._getAllContents();\n\n            case 4:\n              localDatastore = _context10.sent;\n              objectKey = this.getKeyForObject(object);\n              pin = localDatastore[objectKey];\n\n              if (pin) {\n                _context10.next = 9;\n                break;\n              }\n\n              return _context10.abrupt(\"return\");\n\n            case 9:\n              promises = [this.unPinWithName(objectKey)];\n              delete localDatastore[objectKey];\n\n              for (key in localDatastore) {\n                if (key === _LocalDatastoreUtils.DEFAULT_PIN || (0, _startsWith.default)(key).call(key, _LocalDatastoreUtils.PIN_PREFIX)) {\n                  pinned = localDatastore[key] || [];\n\n                  if ((0, _includes.default)(pinned).call(pinned, objectKey)) {\n                    pinned = (0, _filter.default)(pinned).call(pinned, function (item) {\n                      return item !== objectKey;\n                    });\n\n                    if (pinned.length == 0) {\n                      promises.push(this.unPinWithName(key));\n                      delete localDatastore[key];\n                    } else {\n                      promises.push(this.pinWithName(key, pinned));\n                      localDatastore[key] = pinned;\n                    }\n                  }\n                }\n              }\n\n              return _context10.abrupt(\"return\", _promise.default.all(promises));\n\n            case 13:\n            case \"end\":\n              return _context10.stop();\n          }\n        }\n      }, _callee6, this);\n    }));\n\n    return function () {\n      return _destroyObjectIfPinned2.apply(this, arguments);\n    };\n  }(),\n  // Update pin and references of the unsaved object\n  _updateLocalIdForObject: function () {\n    var _updateLocalIdForObject2 = (0, _asyncToGenerator2.default)(\n    /*#__PURE__*/\n    _regenerator.default.mark(function _callee7(localId\n    /*: string*/\n    , object\n    /*: ParseObject*/\n    ) {\n      var _context11, _context12;\n\n      var localKey, objectKey, unsaved, promises, localDatastore, key, pinned;\n      return _regenerator.default.wrap(function (_context13) {\n        while (1) {\n          switch (_context13.prev = _context13.next) {\n            case 0:\n              if (this.isEnabled) {\n                _context13.next = 2;\n                break;\n              }\n\n              return _context13.abrupt(\"return\");\n\n            case 2:\n              localKey = (0, _concat.default)(_context11 = (0, _concat.default)(_context12 = \"\".concat(_LocalDatastoreUtils.OBJECT_PREFIX)).call(_context12, object.className, \"_\")).call(_context11, localId);\n              objectKey = this.getKeyForObject(object);\n              _context13.next = 6;\n              return this.fromPinWithName(localKey);\n\n            case 6:\n              unsaved = _context13.sent;\n\n              if (!(!unsaved || unsaved.length === 0)) {\n                _context13.next = 9;\n                break;\n              }\n\n              return _context13.abrupt(\"return\");\n\n            case 9:\n              promises = [this.unPinWithName(localKey), this.pinWithName(objectKey, unsaved)];\n              _context13.next = 12;\n              return this._getAllContents();\n\n            case 12:\n              localDatastore = _context13.sent;\n\n              for (key in localDatastore) {\n                if (key === _LocalDatastoreUtils.DEFAULT_PIN || (0, _startsWith.default)(key).call(key, _LocalDatastoreUtils.PIN_PREFIX)) {\n                  pinned = localDatastore[key] || [];\n\n                  if ((0, _includes.default)(pinned).call(pinned, localKey)) {\n                    pinned = (0, _filter.default)(pinned).call(pinned, function (item) {\n                      return item !== localKey;\n                    });\n                    pinned.push(objectKey);\n                    promises.push(this.pinWithName(key, pinned));\n                    localDatastore[key] = pinned;\n                  }\n                }\n              }\n\n              return _context13.abrupt(\"return\", _promise.default.all(promises));\n\n            case 15:\n            case \"end\":\n              return _context13.stop();\n          }\n        }\n      }, _callee7, this);\n    }));\n\n    return function () {\n      return _updateLocalIdForObject2.apply(this, arguments);\n    };\n  }(),\n\n  /**\n   * Updates Local Datastore from Server\n   *\n   * <pre>\n   * await Parse.LocalDatastore.updateFromServer();\n   * </pre>\n   * @method updateFromServer\n   * @name Parse.LocalDatastore.updateFromServer\n   * @static\n   */\n  updateFromServer: function () {\n    var _updateFromServer = (0, _asyncToGenerator2.default)(\n    /*#__PURE__*/\n    _regenerator.default.mark(function _callee8() {\n      var _context14,\n          _this2 = this;\n\n      var localDatastore, keys, key, pointersHash, _i, _keys, _key, _key$split, _key$split2, className, objectId, queryPromises, responses, objects, pinPromises;\n\n      return _regenerator.default.wrap(function (_context15) {\n        while (1) {\n          switch (_context15.prev = _context15.next) {\n            case 0:\n              if (!(!this.checkIfEnabled() || this.isSyncing)) {\n                _context15.next = 2;\n                break;\n              }\n\n              return _context15.abrupt(\"return\");\n\n            case 2:\n              _context15.next = 4;\n              return this._getAllContents();\n\n            case 4:\n              localDatastore = _context15.sent;\n              keys = [];\n\n              for (key in localDatastore) {\n                if ((0, _startsWith.default)(key).call(key, _LocalDatastoreUtils.OBJECT_PREFIX)) {\n                  keys.push(key);\n                }\n              }\n\n              if (!(keys.length === 0)) {\n                _context15.next = 9;\n                break;\n              }\n\n              return _context15.abrupt(\"return\");\n\n            case 9:\n              this.isSyncing = true;\n              pointersHash = {};\n              _i = 0, _keys = keys;\n\n            case 12:\n              if (!(_i < _keys.length)) {\n                _context15.next = 23;\n                break;\n              }\n\n              _key = _keys[_i]; // Ignore the OBJECT_PREFIX\n\n              _key$split = _key.split('_'), _key$split2 = (0, _slicedToArray2.default)(_key$split, 4), className = _key$split2[2], objectId = _key$split2[3]; // User key is split into [ 'Parse', 'LDS', '', 'User', 'objectId' ]\n\n              if (_key.split('_').length === 5 && _key.split('_')[3] === 'User') {\n                className = '_User';\n                objectId = _key.split('_')[4];\n              }\n\n              if (!(0, _startsWith.default)(objectId).call(objectId, 'local')) {\n                _context15.next = 18;\n                break;\n              }\n\n              return _context15.abrupt(\"continue\", 20);\n\n            case 18:\n              if (!(className in pointersHash)) {\n                pointersHash[className] = new _set.default();\n              }\n\n              pointersHash[className].add(objectId);\n\n            case 20:\n              _i++;\n              _context15.next = 12;\n              break;\n\n            case 23:\n              queryPromises = (0, _map.default)(_context14 = (0, _keys3.default)(pointersHash)).call(_context14, function (className) {\n                var objectIds = (0, _from.default)(pointersHash[className]);\n                var query = new _ParseQuery.default(className);\n                query.limit(objectIds.length);\n\n                if (objectIds.length === 1) {\n                  query.equalTo('objectId', objectIds[0]);\n                } else {\n                  query.containedIn('objectId', objectIds);\n                }\n\n                return (0, _find.default)(query).call(query);\n              });\n              _context15.prev = 24;\n              _context15.next = 27;\n              return _promise.default.all(queryPromises);\n\n            case 27:\n              responses = _context15.sent;\n              objects = (0, _concat.default)([]).apply([], responses);\n              pinPromises = (0, _map.default)(objects).call(objects, function (object) {\n                var objectKey = _this2.getKeyForObject(object);\n\n                return _this2.pinWithName(objectKey, object._toFullJSON());\n              });\n              _context15.next = 32;\n              return _promise.default.all(pinPromises);\n\n            case 32:\n              this.isSyncing = false;\n              _context15.next = 39;\n              break;\n\n            case 35:\n              _context15.prev = 35;\n              _context15.t0 = _context15[\"catch\"](24);\n              console.error('Error syncing LocalDatastore: ', _context15.t0);\n              this.isSyncing = false;\n\n            case 39:\n            case \"end\":\n              return _context15.stop();\n          }\n        }\n      }, _callee8, this, [[24, 35]]);\n    }));\n\n    return function () {\n      return _updateFromServer.apply(this, arguments);\n    };\n  }(),\n  getKeyForObject: function (object\n  /*: any*/\n  ) {\n    var _context16, _context17;\n\n    var objectId = object.objectId || object._getId();\n\n    return (0, _concat.default)(_context16 = (0, _concat.default)(_context17 = \"\".concat(_LocalDatastoreUtils.OBJECT_PREFIX)).call(_context17, object.className, \"_\")).call(_context16, objectId);\n  },\n  getPinName: function (pinName\n  /*: ?string*/\n  ) {\n    if (!pinName || pinName === _LocalDatastoreUtils.DEFAULT_PIN) {\n      return _LocalDatastoreUtils.DEFAULT_PIN;\n    }\n\n    return _LocalDatastoreUtils.PIN_PREFIX + pinName;\n  },\n  checkIfEnabled: function () {\n    if (!this.isEnabled) {\n      console.error('Parse.enableLocalDatastore() must be called first');\n    }\n\n    return this.isEnabled;\n  }\n};\nmodule.exports = LocalDatastore;\n\n_CoreManager.default.setLocalDatastoreController(require('./LocalDatastoreController'));\n\n_CoreManager.default.setLocalDatastore(LocalDatastore);"]},"metadata":{},"sourceType":"script"}